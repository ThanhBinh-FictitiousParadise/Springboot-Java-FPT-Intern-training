<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/main}">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<div layout:fragment="content" class="container mt-5">
    <h2 class="text-primary fw-bold">Edit Student</h2>

    <form th:action="@{/students/edit/{id}(id=${student.id})}" method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
        <div class="mb-3 text-center">
            <img id="preview"
                 th:src="@{${student.imageFilename != null ? '/uploads/' + student.imageFilename : '/uploads/default_user.png'}}"
                 alt="Profile Image" class="img-thumbnail rounded-circle profile-image" style="width: 150px; height: 150px;">
            <input type="file" name="image" class="form-control mt-2" onchange="previewImage(event)">
        </div>

        <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input type="text" id="name" name="name" th:value="${student.name}" class="form-control" required>
            <div class="invalid-feedback">Please enter the student's name.</div>
        </div>

        <div class="mb-3">
            <label for="email" class="form-label">Email</label>
            <input type="email" id="email" name="email" th:value="${student.email}" class="form-control" required>
            <div class="invalid-feedback">Please enter a valid email address.</div>
        </div>

        <div class="mb-3">
            <label for="dateOfBirth" class="form-label">Date of Birth</label>
            <input type="date" id="dateOfBirth" name="dateOfBirth"
                   th:value="${#temporals.format(student.dateOfBirth, 'yyyy-MM-dd')}" class="form-control">
        </div>

        <div class="mb-3">
            <label for="contact" class="form-label">Contact</label>
            <input type="text" id="contact" name="contact" th:value="${student.contact}" class="form-control">
        </div>

        <div class="mb-3">
            <label for="address" class="form-label">Address</label>
            <textarea id="address" name="address" class="form-control" rows="3" th:text="${student.address}"></textarea>
        </div>

        <button type="submit" class="btn btn-primary">Update Student</button>
        <a th:href="@{/students}" class="btn btn-secondary">Cancel</a>
    </form>

    <div th:if="${error}" class="alert alert-danger mt-3" th:text="${error}"></div>
</div>

<!-- Script Fragment -->
<th:block layout:fragment="scripts">
    <script th:inline="javascript">
        function previewImage(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('preview');

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                preview.src = "/uploads/default_user.png";
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.querySelector('form').addEventListener('submit', function(event) {
                if (!this.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                this.classList.add('was-validated');
            });
        });
    </script>
</th:block>
</body>
</html>